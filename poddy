
#!/bin/bash
#command = install | uninstall
command=${1:-empty}
shift
if [[ $command == add || $command == a ]]; then
    for arg in "$@"; do
        echo "INSTALLING: $arg"
        $PODDY/installers/$arg install
    done
elif [[ $command == remove || $command == r ]]; then
    for arg in "$@"; do
        echo "UNINSTALLING: $arg"
        $PODDY/installers/$arg uninstall
    done
elif [[ $command == update || $command == u ]]; then
    echo "UPDATING"
    if [[ -d $PORTA_PODDY ]]; then
        rm -r $PORTA_PODDY
    fi
    if [[ -d $PODDY/uninstall ]]; then
        rm -r $PODDY/uninstall
    fi
    if [[ -d $PODDY/installer ]]; then
        rm -r $PODDY/installer
    fi
    if [[ -d $PODDY/installers ]]; then
        rm -r $PODDY/installers
    fi
    if [[ -d $PODDY/workflows ]]; then
        rm -r $PODDY/workflows
    fi

    mkdir -p $PORTA_PODDY
    git clone https://github.com/ndrwmoss/going_poddy $PORTA_PODDY
    echo "INSTALLING UPGRADES"
    cp -r $PORTA_PODDY/install $PODDY/install
    cp -r $PORTA_PODDY/uninstall $PODDY/uninstall
    cp -r $PORTA_PODDY/installers $PODDY/installers
    cp -r $PORTA_PODDY/workflows $PODDY/workflows
    chmod -R +x $PODDY/install
    chmod -R +x $PODDY/uninstall
    chmod -R +x $PODDY/installers
    if [[ $1 == test ]]; then
        echo "Installing WIP items"
        if [[ -d $PODDY/installers ]]; then
            rm -r $PODDY/installers
        fi
        if [[ -d $PODDY/workflows ]]; then
            rm -r $PODDY/workflows
        fi
        cp -r $PORTA_PODDY/wip/installers $PODDY/installers
        cp -r $PORTA_PODDY/wip/workflows $PODDY/workflows
        chmod -R +x $PODDY/installers
    fi
    rm -r $PORTA_PODDY
fi