#!/bin/bash
# --- Configuration ---
DIALOG_HEIGHT=20
DIALOG_WIDTH=60
MENU_HEIGHT=15
TITLE="Select a file"
PROMPT="Choose a file to display its full path:"

# Use a temporary file for dialog output
if [[ -f $PODDY/tmp/mm_tmp ]]; then
    rm $PODDY/tmp/mm_tmp
fi
touch $PODDY/tmp/mm_tmp
tmpfile=$PODDY/tmp/mm_tmp


# Prepare menu items (tag item format: 'tag' 'description')
# The tag is the value returned by dialog.
menu_items=()
# check if list has items
make_list () {
    i=0
    while IFS= read -r line; do
        # Only process non-empty lines for the menu
        if [[ -n $line ]]; then
            ((i++))
        fi
    done < $1
    if [[ $i != 0 ]]; then
        if [[ $1 == $PODDY/tmp/wiz_available ]]; then
            menu_items+=("1" "Install")
        else
            menu_items+=("2" "Uninstall")
        fi
    fi
}
make_list $PODDY/tmp/wiz_available
make_list $PODDY/tmp/wiz_installed
menu_items+=("3" "Update")
menu_items+=("4" "Add 3rd party repo")

# --- Display the dialog menu ---
# 2>&1 >/dev/tty redirects dialog's output to the terminal, and captures user selection to $tmpfile
dialog --clear --title "$TITLE" --menu "$PROMPT" \
    $DIALOG_HEIGHT $DIALOG_WIDTH $MENU_HEIGHT \
    "${menu_items[@]}" 2> "$tmpfile"

# --- Process user selection ---
return_status=$?
selection=$(cat "$tmpfile")
if [[ $return_status == 0 ]]; then
    echo $selection
    selected_filename="${menu_items[$selection]}"
    dialog --msgbox "You selected: $selection\nFull path: $(pwd)/$selected_filename" 10 60
        ;;
else
    exit 0
fi

# Clean up the temporary file (handled by the trap command)
rm $PODDY/tmp/mm_tmp