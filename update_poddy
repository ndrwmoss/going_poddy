
#!/bin/bash
PODDY=${PODDY:-/going_poddy}
PORTA_PODDY=${PORTA_PODDY:-$PODDY/going_poddy}
PODDY_WORKFLOWS=${PODDY_WORKFLOWS:-$PODDY/workflows}
COMFY=${COMFY:-/workspace/ComfyUI}
COMFY_WORKFLOW=${COMFY_WORKFLOW:-$COMFY/user/default/workflows}
restore_cwd=${PWD}

echo "FLUSHING PODDY"
if [[ -d $PORTA_PODDY ]]; then
    rm -r $PORTA_PODDY
fi
cd $PODDY
# DOWNLOAD
echo "Hydrating Poddy"
git clone https://github.com/ndrwmoss/going_poddy

if [[ -d ${PODDY}/cmd ]]; then
    rm -R ${PODDY}/cmd
fi
cp -r $PORTA_PODDY/cmd $PODDY/cmd
chmod -R +x $PODDY/cmd

if [[ -d ${PODDY}/installers ]]; then
    rm -R ${PODDY}/installers
fi
cp -r $PORTA_PODDY/installers $PODDY/installers
chmod -R +x $PODDY/installers

if [[ -d ${PODDY}/workflows ]]; then
    rm -R ${PODDY}/workflows
fi
cp -r $PORTA_PODDY/workflows $PODDY/workflows

if [[ -f /poddy ]]; then
    rm -R /poddy
fi
cp -f $PORTA_PODDY/poddy /poddy
chmod +x /poddy


# COPY NEW WORKFLOWS TO WORKFLOW DIRECTORY
for wf in ${PODDY_WORKFLOWS}/*.json; do
    if [[ -f ${COMFY_WORKFLOW}/${wf}.json ]]; then
        rm ${COMFY_WORKFLOW}/${wf}.json
        cp -f ${PODDY_WORKFLOWS}/${wf}.json ${COMFY_WORKFLOW}/${wf}.json
    fi
done
echo "Poddy Refreshed!"

cd $restore_cwd